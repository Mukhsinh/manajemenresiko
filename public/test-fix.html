<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fix - Data Display & Button Functions</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .data-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .data-table th, .data-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .data-table th { background: #f8f9fa; }
        .btn-test { background: #28a745; }
        .btn-test:hover { background: #1e7e34; }
    </style>
</head>
<body>
    <h1>Test Fix - Data Display & Button Functions</h1>
    <p>Halaman ini untuk menguji apakah data dapat dimuat dan tombol berfungsi dengan benar.</p>

    <!-- Test Dashboard Data -->
    <div class="test-section">
        <h2>Test 1: Dashboard Data</h2>
        <button onclick="testDashboardData()" class="btn-test">Test Dashboard Data</button>
        <div id="dashboard-test-result" class="test-result loading">Klik tombol untuk menguji...</div>
        <div id="dashboard-data-display"></div>
    </div>

    <!-- Test Master Data -->
    <div class="test-section">
        <h2>Test 2: Master Data</h2>
        <button onclick="testMasterData('work-units')" class="btn-test">Test Unit Kerja</button>
        <button onclick="testMasterData('risk-categories')" class="btn-test">Test Kategori Risiko</button>
        <div id="master-test-result" class="test-result loading">Klik tombol untuk menguji...</div>
        <div id="master-data-display"></div>
    </div>

    <!-- Test Visi Misi -->
    <div class="test-section">
        <h2>Test 3: Visi Misi Data</h2>
        <button onclick="testVisiMisi()" class="btn-test">Test Visi Misi</button>
        <div id="visi-misi-test-result" class="test-result loading">Klik tombol untuk menguji...</div>
        <div id="visi-misi-data-display"></div>
    </div>

    <!-- Test Rencana Strategis -->
    <div class="test-section">
        <h2>Test 4: Rencana Strategis Data</h2>
        <button onclick="testRencanaStrategis()" class="btn-test">Test Rencana Strategis</button>
        <div id="rencana-strategis-test-result" class="test-result loading">Klik tombol untuk menguji...</div>
        <div id="rencana-strategis-data-display"></div>
    </div>

    <!-- Test Button Functions -->
    <div class="test-section">
        <h2>Test 5: Button Functions</h2>
        <button onclick="testButtonFunction('add')" class="btn-test">Test Add Button</button>
        <button onclick="testButtonFunction('edit')" class="btn-test">Test Edit Button</button>
        <button onclick="testButtonFunction('delete')" class="btn-test">Test Delete Button</button>
        <div id="button-test-result" class="test-result loading">Klik tombol untuk menguji...</div>
    </div>

    <script>
        // Test Dashboard Data
        async function testDashboardData() {
            const resultDiv = document.getElementById('dashboard-test-result');
            const displayDiv = document.getElementById('dashboard-data-display');
            
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = 'Menguji dashboard data...';
            
            try {
                // Test authenticated endpoint
                let response = await fetch('/api/simple/dashboard');
                let data;
                
                if (response.ok) {
                    data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'SUCCESS: Dashboard data loaded from authenticated endpoint';
                } else {
                    // Fallback to test endpoint
                    response = await fetch('/api/test-data/dashboard');
                    if (response.ok) {
                        data = await response.json();
                        resultDiv.className = 'test-result success';
                        resultDiv.textContent = 'SUCCESS: Dashboard data loaded from test endpoint (fallback)';
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                }
                
                // Display data
                displayDiv.innerHTML = `
                    <h4>Dashboard Statistics:</h4>
                    <ul>
                        <li>Total Risks: ${data.total_risks || 0}</li>
                        <li>Loss Events: ${data.loss_events || 0}</li>
                        <li>Visi Misi: ${data.sample_data?.visi_misi?.length || 0}</li>
                        <li>Rencana Strategis: ${data.sample_data?.rencana_strategis?.length || 0}</li>
                    </ul>
                `;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `ERROR: ${error.message}`;
                displayDiv.innerHTML = '';
            }
        }

        // Test Master Data
        async function testMasterData(type) {
            const resultDiv = document.getElementById('master-test-result');
            const displayDiv = document.getElementById('master-data-display');
            
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = `Menguji master data ${type}...`;
            
            try {
                // Test authenticated endpoint
                let response = await fetch(`/api/master-data/${type}`);
                let data;
                
                if (response.ok) {
                    data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `SUCCESS: Master data ${type} loaded from authenticated endpoint`;
                } else {
                    // Fallback to test endpoint
                    response = await fetch(`/api/test-data/master/${type}`);
                    if (response.ok) {
                        data = await response.json();
                        resultDiv.className = 'test-result success';
                        resultDiv.textContent = `SUCCESS: Master data ${type} loaded from test endpoint (fallback)`;
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                }
                
                // Display data
                if (Array.isArray(data) && data.length > 0) {
                    const headers = Object.keys(data[0]).slice(0, 4); // Show first 4 columns
                    displayDiv.innerHTML = `
                        <h4>Master Data ${type} (${data.length} records):</h4>
                        <table class="data-table">
                            <thead>
                                <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
                            </thead>
                            <tbody>
                                ${data.slice(0, 5).map(item => 
                                    `<tr>${headers.map(h => `<td>${item[h] || '-'}</td>`).join('')}</tr>`
                                ).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    displayDiv.innerHTML = `<p>No data found for ${type}</p>`;
                }
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `ERROR: ${error.message}`;
                displayDiv.innerHTML = '';
            }
        }

        // Test Visi Misi
        async function testVisiMisi() {
            const resultDiv = document.getElementById('visi-misi-test-result');
            const displayDiv = document.getElementById('visi-misi-data-display');
            
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = 'Menguji visi misi data...';
            
            try {
                // Test authenticated endpoint
                let response = await fetch('/api/simple/visi-misi');
                let data;
                
                if (response.ok) {
                    data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'SUCCESS: Visi Misi data loaded from authenticated endpoint';
                } else {
                    // Fallback to test endpoint
                    response = await fetch('/api/test-data/visi-misi');
                    if (response.ok) {
                        data = await response.json();
                        resultDiv.className = 'test-result success';
                        resultDiv.textContent = 'SUCCESS: Visi Misi data loaded from test endpoint (fallback)';
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                }
                
                // Display data
                if (Array.isArray(data) && data.length > 0) {
                    displayDiv.innerHTML = `
                        <h4>Visi Misi Data (${data.length} records):</h4>
                        <table class="data-table">
                            <thead>
                                <tr><th>Tahun</th><th>Visi</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                ${data.slice(0, 3).map(item => 
                                    `<tr>
                                        <td>${item.tahun}</td>
                                        <td>${(item.visi || '').substring(0, 100)}${item.visi?.length > 100 ? '...' : ''}</td>
                                        <td>${item.status}</td>
                                    </tr>`
                                ).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    displayDiv.innerHTML = '<p>No visi misi data found</p>';
                }
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `ERROR: ${error.message}`;
                displayDiv.innerHTML = '';
            }
        }

        // Test Rencana Strategis
        async function testRencanaStrategis() {
            const resultDiv = document.getElementById('rencana-strategis-test-result');
            const displayDiv = document.getElementById('rencana-strategis-data-display');
            
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = 'Menguji rencana strategis data...';
            
            try {
                // Test authenticated endpoint
                let response = await fetch('/api/simple/rencana-strategis');
                let data;
                
                if (response.ok) {
                    data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'SUCCESS: Rencana Strategis data loaded from authenticated endpoint';
                } else {
                    // Fallback to test endpoint
                    response = await fetch('/api/test-data/rencana-strategis');
                    if (response.ok) {
                        data = await response.json();
                        resultDiv.className = 'test-result success';
                        resultDiv.textContent = 'SUCCESS: Rencana Strategis data loaded from test endpoint (fallback)';
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                }
                
                // Display data
                if (Array.isArray(data) && data.length > 0) {
                    displayDiv.innerHTML = `
                        <h4>Rencana Strategis Data (${data.length} records):</h4>
                        <table class="data-table">
                            <thead>
                                <tr><th>Kode</th><th>Nama Rencana</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                ${data.slice(0, 3).map(item => 
                                    `<tr>
                                        <td>${item.kode}</td>
                                        <td>${(item.nama_rencana || '').substring(0, 50)}${item.nama_rencana?.length > 50 ? '...' : ''}</td>
                                        <td>${item.status}</td>
                                    </tr>`
                                ).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    displayDiv.innerHTML = '<p>No rencana strategis data found</p>';
                }
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `ERROR: ${error.message}`;
                displayDiv.innerHTML = '';
            }
        }

        // Test Button Functions
        function testButtonFunction(action) {
            const resultDiv = document.getElementById('button-test-result');
            
            resultDiv.className = 'test-result loading';
            resultDiv.textContent = `Testing ${action} button function...`;
            
            // Simulate button function test
            setTimeout(() => {
                try {
                    // Test if button event handlers work
                    const testButton = document.createElement('button');
                    testButton.dataset.action = action;
                    testButton.dataset.endpoint = 'test-endpoint';
                    testButton.dataset.id = 'test-id';
                    
                    // Simulate click event
                    const event = new Event('click');
                    testButton.dispatchEvent(event);
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `SUCCESS: ${action} button function works correctly`;
                    
                } catch (error) {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = `ERROR: ${action} button function failed - ${error.message}`;
                }
            }, 500);
        }

        // Auto-run dashboard test on page load
        window.addEventListener('load', () => {
            setTimeout(testDashboardData, 1000);
        });
    </script>
</body>
</html>