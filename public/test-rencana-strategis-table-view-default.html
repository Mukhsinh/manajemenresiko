<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rencana Strategis - Table View Default</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .badge {
            font-size: 0.75em;
        }
        
        .badge-success {
            background-color: #28a745;
            color: white;
        }
        
        .badge-warning {
            background-color: #ffc107;
            color: #212529;
        }
        
        .badge-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .action-group .btn {
            margin-left: 0.25rem;
        }
        
        .empty-state {
            padding: 3rem 1rem;
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .table-dark {
            background-color: #343a40;
            color: white;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.075);
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        .navbar {
            background-color: #2c5aa0 !important;
        }
        
        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
        }
        
        .container-fluid {
            padding-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-hospital"></i> PINTAR MR
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text text-white">
                    <i class="fas fa-user"></i> Administrator
                </span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i> Dashboard</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Rencana Strategis</li>
                    </ol>
                </nav>

                <!-- Main Content -->
                <div id="rencana-strategis" class="page-content active">
                    <div id="rencana-strategis-content">
                        <!-- Content will be rendered here by JavaScript -->
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Memuat data rencana strategis...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mock API and Auth -->
    <script>
        // Mock authentication
        window.waitForAuthReady = async (timeout = 5000) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    console.log('‚úÖ Mock auth ready');
                    resolve(true);
                }, 100);
            });
        };

        // Mock API service
        window.apiCall = async (endpoint, options = {}) => {
            console.log('üì° Mock API call:', endpoint, options);
            
            // Mock data - lebih banyak untuk testing table
            const mockRencanaData = [
                {
                    id: '1',
                    kode: 'RS-2025-001',
                    nama_rencana: 'Peningkatan Kualitas Pelayanan Kesehatan',
                    deskripsi: 'Rencana strategis untuk meningkatkan kualitas pelayanan kesehatan di rumah sakit dengan fokus pada kepuasan pasien dan efisiensi operasional',
                    periode_mulai: '2025-01-01',
                    periode_selesai: '2025-12-31',
                    target: 'Meningkatkan kepuasan pasien hingga 90%',
                    indikator_kinerja: 'Indeks Kepuasan Pasien',
                    status: 'Aktif',
                    visi_misi_id: '1',
                    sasaran_strategis: ['Pelayanan Prima', 'Kepuasan Pasien'],
                    indikator_kinerja_utama: ['IKP >= 90%', 'Waktu Tunggu < 30 menit']
                },
                {
                    id: '2',
                    kode: 'RS-2025-002',
                    nama_rencana: 'Digitalisasi Sistem Informasi',
                    deskripsi: 'Implementasi sistem informasi terintegrasi untuk efisiensi operasional dan akurasi data',
                    periode_mulai: '2025-02-01',
                    periode_selesai: '2025-11-30',
                    target: 'Implementasi SIMRS 100%',
                    indikator_kinerja: 'Persentase Modul Terimplementasi',
                    status: 'Draft',
                    visi_misi_id: '1',
                    sasaran_strategis: ['Efisiensi Operasional', 'Akurasi Data'],
                    indikator_kinerja_utama: ['Implementasi 100%', 'Akurasi Data 99%']
                },
                {
                    id: '3',
                    kode: 'RS-2025-003',
                    nama_rencana: 'Pengembangan SDM Medis',
                    deskripsi: 'Program pelatihan dan pengembangan kompetensi tenaga medis untuk meningkatkan kualitas pelayanan',
                    periode_mulai: '2025-03-01',
                    periode_selesai: '2025-12-31',
                    target: 'Pelatihan 100% tenaga medis',
                    indikator_kinerja: 'Persentase Tenaga Medis Terlatih',
                    status: 'Aktif',
                    visi_misi_id: '2',
                    sasaran_strategis: ['Kompetensi SDM', 'Kualitas Pelayanan'],
                    indikator_kinerja_utama: ['Pelatihan 100%', 'Sertifikasi 95%']
                },
                {
                    id: '4',
                    kode: 'RS-2025-004',
                    nama_rencana: 'Peningkatan Infrastruktur Medis',
                    deskripsi: 'Modernisasi peralatan medis dan infrastruktur rumah sakit',
                    periode_mulai: '2025-04-01',
                    periode_selesai: '2025-12-31',
                    target: 'Modernisasi 80% peralatan medis',
                    indikator_kinerja: 'Persentase Peralatan Termodernisasi',
                    status: 'Draft',
                    visi_misi_id: '1',
                    sasaran_strategis: ['Infrastruktur Modern', 'Teknologi Terkini'],
                    indikator_kinerja_utama: ['Modernisasi 80%', 'Downtime < 5%']
                },
                {
                    id: '5',
                    kode: 'RS-2025-005',
                    nama_rencana: 'Program Keselamatan Pasien',
                    deskripsi: 'Implementasi program keselamatan pasien yang komprehensif',
                    periode_mulai: '2025-01-15',
                    periode_selesai: '2025-12-31',
                    target: 'Zero incident keselamatan pasien',
                    indikator_kinerja: 'Jumlah Insiden Keselamatan',
                    status: 'Selesai',
                    visi_misi_id: '2',
                    sasaran_strategis: ['Keselamatan Pasien', 'Standar Internasional'],
                    indikator_kinerja_utama: ['Zero Incident', 'Akreditasi JCI']
                }
            ];

            const mockVisiMisiData = [
                {
                    id: '1',
                    visi: 'Menjadi rumah sakit terdepan dalam pelayanan kesehatan',
                    misi: '1. Memberikan pelayanan kesehatan berkualitas\n2. Mengembangkan teknologi medis terkini\n3. Meningkatkan kompetensi SDM'
                },
                {
                    id: '2',
                    visi: 'Rumah sakit pilihan utama masyarakat',
                    misi: '1. Pelayanan prima dan terjangkau\n2. Inovasi berkelanjutan\n3. Kemitraan strategis'
                }
            ];

            // Simulate API responses
            if (endpoint.includes('/api/rencana-strategis')) {
                if (endpoint.includes('/generate/kode')) {
                    return { kode: `RS-2025-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}` };
                }
                if (options.method === 'POST') {
                    return { success: true, message: 'Data berhasil disimpan' };
                }
                if (options.method === 'PUT') {
                    return { success: true, message: 'Data berhasil diupdate' };
                }
                if (options.method === 'DELETE') {
                    return { success: true, message: 'Data berhasil dihapus' };
                }
                return mockRencanaData;
            }
            
            if (endpoint.includes('/api/visi-misi')) {
                return mockVisiMisiData;
            }
            
            return [];
        };

        // Mock app object
        window.app = {
            apiCall: window.apiCall
        };
    </script>

    <!-- Load the NEW Rencana Strategis module with table default -->
    <script src="/js/rencana-strategis-table-default.js"></script>

    <script>
        // Initialize the module when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Initializing Rencana Strategis with Table Default...');
            
            try {
                // Wait a bit for everything to load
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Load the module
                if (window.RencanaStrategisModule) {
                    await window.RencanaStrategisModule.load();
                    console.log('‚úÖ Rencana Strategis module loaded successfully with table view');
                    
                    // Verify table view is active
                    setTimeout(() => {
                        const tableSection = document.getElementById('table-section');
                        if (tableSection && tableSection.style.display !== 'none') {
                            console.log('‚úÖ Table view confirmed as default');
                        } else {
                            console.log('‚ùå Table view not showing as default');
                        }
                    }, 1000);
                } else {
                    console.error('‚ùå RencanaStrategisModule not found');
                }
            } catch (error) {
                console.error('‚ùå Error initializing:', error);
            }
        });
    </script>
</body>
</html>