<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tampilan Rencana Strategis - Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/rencana-strategis.css">
    <style>
        body { background: #f5f7fa; padding: 20px; }
        .test-log { 
            background: #1e293b; 
            color: #e2e8f0; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .test-log .success { color: #4ade80; }
        .test-log .error { color: #f87171; }
        .test-log .info { color: #60a5fa; }
        .test-log .warn { color: #fbbf24; }
        .page-content { display: block !important; }
        .page-content.active { display: block !important; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h2 class="mb-4"><i class="fas fa-chart-line text-primary"></i> Test Tampilan Rencana Strategis</h2>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-terminal"></i> Test Log
                    </div>
                    <div class="card-body p-0">
                        <div class="test-log" id="test-log"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <i class="fas fa-check-circle"></i> Test Actions
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary me-2" onclick="testLoadModule()">
                            <i class="fas fa-play"></i> Load Module
                        </button>
                        <button class="btn btn-info me-2" onclick="testApiCall()">
                            <i class="fas fa-database"></i> Test API
                        </button>
                        <button class="btn btn-warning me-2" onclick="forceRender()">
                            <i class="fas fa-sync"></i> Force Render
                        </button>
                        <button class="btn btn-secondary" onclick="clearLog()">
                            <i class="fas fa-trash"></i> Clear Log
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Simulated Page Container -->
        <div id="rencana-strategis" class="page-content active">
            <div class="page-header mb-4">
                <h1 class="page-title"><i class="page-title-icon fas fa-chart-line"></i> Rencana Strategis</h1>
                <p class="page-subtitle text-muted">Perencanaan Strategis Organisasi</p>
            </div>
            <div id="rencana-strategis-content">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-3 text-muted">Memuat modul...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Test logging
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }
        
        // Mock API call function
        window.apiCall = async function(endpoint, options = {}) {
            log(`API Call: ${endpoint}`, 'info');
            
            const response = await fetch(endpoint, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                body: options.body ? JSON.stringify(options.body) : undefined
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            return response.json();
        };
        
        // Test API call
        async function testApiCall() {
            log('Testing API endpoints...', 'info');
            
            try {
                // Test rencana-strategis public endpoint
                const rsData = await fetch('/api/rencana-strategis/public').then(r => r.json());
                log(`‚úÖ Rencana Strategis: ${rsData.length} records`, 'success');
                
                // Test visi-misi public endpoint
                const vmData = await fetch('/api/visi-misi/public').then(r => r.json());
                log(`‚úÖ Visi Misi: ${vmData.length} records`, 'success');
                
                // Test generate kode
                const kodeData = await fetch('/api/rencana-strategis/generate/kode/public').then(r => r.json());
                log(`‚úÖ Generated Kode: ${kodeData.kode}`, 'success');
                
            } catch (error) {
                log(`‚ùå API Error: ${error.message}`, 'error');
            }
        }
        
        // Test load module
        async function testLoadModule() {
            log('Loading Rencana Strategis Module...', 'info');
            
            try {
                if (window.RencanaStrategisModule && typeof window.RencanaStrategisModule.load === 'function') {
                    await window.RencanaStrategisModule.load();
                    log('‚úÖ Module loaded successfully', 'success');
                    
                    // Check if content was rendered
                    setTimeout(() => {
                        const container = document.getElementById('rencana-strategis-content');
                        if (container) {
                            const hasTable = container.querySelector('table');
                            const hasCards = container.querySelector('.rencana-strategis-wrapper');
                            
                            if (hasTable) {
                                log('‚úÖ Table rendered', 'success');
                            } else {
                                log('‚ö†Ô∏è Table not found', 'warn');
                            }
                            
                            if (hasCards) {
                                log('‚úÖ Cards wrapper rendered', 'success');
                            } else {
                                log('‚ö†Ô∏è Cards wrapper not found', 'warn');
                            }
                            
                            // Count stat cards
                            const statCards = container.querySelectorAll('.row.g-3.mb-4 .card');
                            log(`üìä Stat cards found: ${statCards.length}`, 'info');
                            
                            // Count table rows
                            const tableRows = container.querySelectorAll('tbody tr');
                            log(`üìã Table rows found: ${tableRows.length}`, 'info');
                        }
                    }, 1000);
                } else {
                    log('‚ùå RencanaStrategisModule not available', 'error');
                }
            } catch (error) {
                log(`‚ùå Load Error: ${error.message}`, 'error');
            }
        }
        
        // Force render
        function forceRender() {
            log('Force rendering interface...', 'info');
            
            if (window.RencanaStrategisModule && typeof window.RencanaStrategisModule.forceRender === 'function') {
                window.RencanaStrategisModule.forceRender();
                log('‚úÖ Force render called', 'success');
            } else {
                log('‚ùå forceRender function not available', 'error');
            }
        }
        
        // Initialize
        log('Test page loaded', 'info');
        log('Waiting for module script...', 'info');
    </script>
    
    <!-- Load the actual module -->
    <script src="/js/rencana-strategis.js"></script>
    
    <script>
        // Auto-load after script is loaded
        setTimeout(() => {
            if (window.RencanaStrategisModule) {
                log('‚úÖ RencanaStrategisModule detected', 'success');
                log(`Module version: ${window.RencanaStrategisModule.version}`, 'info');
                testLoadModule();
            } else {
                log('‚ùå RencanaStrategisModule not loaded', 'error');
            }
        }, 500);
    </script>
</body>
</html>
