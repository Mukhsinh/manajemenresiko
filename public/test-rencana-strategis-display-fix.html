
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rencana Strategis Display Fix</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-header {
            background: linear-gradient(135deg, #0b4d88, #0f97d6);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .test-section-header {
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .test-section-body {
            padding: 1.5rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        
        .page-content {
            display: none;
            min-height: 400px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #f8f9fa;
        }
        
        .page-content.active {
            display: block;
        }
        
        .log-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .btn-test {
            margin: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1><i class="fas fa-bug"></i> Test Rencana Strategis Display Fix</h1>
            <p>Comprehensive testing for page display without refresh</p>
        </div>
        
        <!-- Test Status -->
        <div class="test-section">
            <div class="test-section-header">
                <h3><i class="fas fa-clipboard-check"></i> Test Status</h3>
            </div>
            <div class="test-section-body">
                <div id="test-status">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Ready to run tests. Click buttons below to test different scenarios.
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Controls -->
        <div class="test-section">
            <div class="test-section-header">
                <h3><i class="fas fa-play-circle"></i> Test Controls</h3>
            </div>
            <div class="test-section-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Navigation Tests</h5>
                        <button class="btn btn-primary btn-test" onclick="testBasicNavigation()">
                            <i class="fas fa-arrow-right"></i> Test Basic Navigation
                        </button>
                        <button class="btn btn-success btn-test" onclick="testEnhancedNavigation()">
                            <i class="fas fa-rocket"></i> Test Enhanced Navigation
                        </button>
                        <button class="btn btn-warning btn-test" onclick="testNavigationLoop()">
                            <i class="fas fa-sync"></i> Test Navigation Loop
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h5>Module Tests</h5>
                        <button class="btn btn-info btn-test" onclick="testModuleLoading()">
                            <i class="fas fa-cogs"></i> Test Module Loading
                        </button>
                        <button class="btn btn-secondary btn-test" onclick="testFallbackMode()">
                            <i class="fas fa-life-ring"></i> Test Fallback Mode
                        </button>
                        <button class="btn btn-danger btn-test" onclick="testErrorHandling()">
                            <i class="fas fa-exclamation-triangle"></i> Test Error Handling
                        </button>
                    </div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-outline-primary" onclick="runAllTests()">
                        <i class="fas fa-play"></i> Run All Tests
                    </button>
                    <button class="btn btn-outline-secondary" onclick="clearLogs()">
                        <i class="fas fa-trash"></i> Clear Logs
                    </button>
                    <button class="btn btn-outline-success" onclick="location.reload()">
                        <i class="fas fa-sync"></i> Reset Page
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mock Pages -->
        <div class="test-section">
            <div class="test-section-header">
                <h3><i class="fas fa-window-restore"></i> Mock Pages</h3>
            </div>
            <div class="test-section-body">
                <div id="dashboard" class="page-content">
                    <h4><i class="fas fa-tachometer-alt"></i> Dashboard Page</h4>
                    <p>This is the dashboard page content.</p>
                </div>
                
                <div id="rencana-strategis" class="page-content">
                    <h4><i class="fas fa-chart-line"></i> Rencana Strategis Page</h4>
                    <div id="rencana-strategis-content">
                        <p>This is where the Rencana Strategis content will be loaded.</p>
                    </div>
                </div>
                
                <div id="analisis-swot" class="page-content">
                    <h4><i class="fas fa-chart-bar"></i> Analisis SWOT Page</h4>
                    <p>This is the analisis SWOT page content.</p>
                </div>
            </div>
        </div>
        
        <!-- Test Logs -->
        <div class="test-section">
            <div class="test-section-header">
                <h3><i class="fas fa-terminal"></i> Test Logs</h3>
            </div>
            <div class="test-section-body">
                <div id="test-logs" class="log-output">
                    Test logs will appear here...
                </div>
            </div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="/js/page-initialization-system-enhanced.js"></script>
    <script src="/js/navigation-override-enhanced.js"></script>
    <script src="/js/rencana-strategis-display-fix.js"></script>
    <script src="/js/rencana-strategis-enhanced.js"></script>
    
    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('test-logs');
            const color = type === 'error' ? '#ff6b6b' : 
                         type === 'success' ? '#51cf66' : 
                         type === 'warning' ? '#ffd43b' : '#74c0fc';
            
            logElement.innerHTML += `[${timestamp}] <span style="color: ${color}">${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[TEST] ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('test-status');
            const alertClass = type === 'error' ? 'alert-danger' : 
                              type === 'success' ? 'alert-success' : 
                              type === 'warning' ? 'alert-warning' : 'alert-info';
            
            statusElement.innerHTML = `
                <div class="alert ${alertClass}">
                    <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 
                                    type === 'success' ? 'check-circle' : 
                                    type === 'warning' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                </div>
            `;
        }
        
        async function testBasicNavigation() {
            log('üß≠ Testing Basic Navigation...', 'info');
            updateStatus('Running basic navigation test...', 'warning');
            
            try {
                // Test navigation to different pages
                const pages = ['dashboard', 'rencana-strategis', 'analisis-swot'];
                
                for (const page of pages) {
                    log(`Navigating to: ${page}`);
                    
                    if (typeof navigateToPage === 'function') {
                        await navigateToPage(page);
                        
                        // Check if page is visible
                        const pageElement = document.getElementById(page);
                        if (pageElement && pageElement.classList.contains('active')) {
                            log(`‚úÖ ${page} is visible`, 'success');
                        } else {
                            log(`‚ùå ${page} is not visible`, 'error');
                        }
                    } else {
                        log('‚ùå navigateToPage function not available', 'error');
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                updateStatus('Basic navigation test completed', 'success');
                
            } catch (error) {
                log(`‚ùå Basic navigation test failed: ${error.message}`, 'error');
                updateStatus('Basic navigation test failed', 'error');
            }
        }
        
        async function testEnhancedNavigation() {
            log('üöÄ Testing Enhanced Navigation...', 'info');
            updateStatus('Running enhanced navigation test...', 'warning');
            
            try {
                // Test enhanced navigation specifically to rencana-strategis
                log('Testing enhanced navigation to rencana-strategis');
                
                if (typeof navigateToPage === 'function') {
                    await navigateToPage('rencana-strategis', { forceReload: true });
                    
                    // Wait for initialization
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Check if page is visible and content is loaded
                    const pageElement = document.getElementById('rencana-strategis');
                    const contentElement = document.getElementById('rencana-strategis-content');
                    
                    if (pageElement && pageElement.classList.contains('active')) {
                        log('‚úÖ Rencana Strategis page is visible', 'success');
                        
                        if (contentElement && contentElement.innerHTML.trim() !== '') {
                            log('‚úÖ Rencana Strategis content is loaded', 'success');
                        } else {
                            log('‚ö†Ô∏è Rencana Strategis content is empty', 'warning');
                        }
                    } else {
                        log('‚ùå Rencana Strategis page is not visible', 'error');
                    }
                } else {
                    log('‚ùå navigateToPage function not available', 'error');
                }
                
                updateStatus('Enhanced navigation test completed', 'success');
                
            } catch (error) {
                log(`‚ùå Enhanced navigation test failed: ${error.message}`, 'error');
                updateStatus('Enhanced navigation test failed', 'error');
            }
        }
        
        async function testNavigationLoop() {
            log('üîÑ Testing Navigation Loop Prevention...', 'info');
            updateStatus('Running navigation loop test...', 'warning');
            
            try {
                // Rapidly navigate between pages to test loop prevention
                for (let i = 0; i < 5; i++) {
                    log(`Loop test iteration ${i + 1}`);
                    await navigateToPage('rencana-strategis');
                    await new Promise(resolve => setTimeout(resolve, 100));
                    await navigateToPage('dashboard');
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                log('‚úÖ Navigation loop test completed without issues', 'success');
                updateStatus('Navigation loop test passed', 'success');
                
            } catch (error) {
                log(`‚ùå Navigation loop test failed: ${error.message}`, 'error');
                updateStatus('Navigation loop test failed', 'error');
            }
        }
        
        async function testModuleLoading() {
            log('üîß Testing Module Loading...', 'info');
            updateStatus('Running module loading test...', 'warning');
            
            try {
                // Check if modules are available
                const modules = [
                    { name: 'PageInitializationSystem', obj: window.PageInitializationSystem },
                    { name: 'RencanaStrategisModuleEnhanced', obj: window.RencanaStrategisModuleEnhanced },
                    { name: 'navigateToPage', obj: window.navigateToPage }
                ];
                
                for (const module of modules) {
                    if (module.obj) {
                        log(`‚úÖ ${module.name} is available`, 'success');
                    } else {
                        log(`‚ùå ${module.name} is not available`, 'error');
                    }
                }
                
                // Test module initialization
                if (window.PageInitializationSystem) {
                    log('Testing PageInitializationSystem...');
                    await window.PageInitializationSystem.initializePage('rencana-strategis');
                    log('‚úÖ PageInitializationSystem test completed', 'success');
                }
                
                updateStatus('Module loading test completed', 'success');
                
            } catch (error) {
                log(`‚ùå Module loading test failed: ${error.message}`, 'error');
                updateStatus('Module loading test failed', 'error');
            }
        }
        
        async function testFallbackMode() {
            log('üõü Testing Fallback Mode...', 'info');
            updateStatus('Running fallback mode test...', 'warning');
            
            try {
                // Temporarily disable main module to test fallback
                const originalModule = window.RencanaStrategisModuleEnhanced;
                window.RencanaStrategisModuleEnhanced = null;
                
                log('Main module disabled, testing fallback...');
                await navigateToPage('rencana-strategis');
                
                // Wait for fallback to load
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Check if fallback content is shown
                const contentElement = document.getElementById('rencana-strategis-content');
                if (contentElement && contentElement.innerHTML.includes('fallback')) {
                    log('‚úÖ Fallback mode is working', 'success');
                } else {
                    log('‚ö†Ô∏è Fallback mode may not be working properly', 'warning');
                }
                
                // Restore original module
                window.RencanaStrategisModuleEnhanced = originalModule;
                log('Original module restored');
                
                updateStatus('Fallback mode test completed', 'success');
                
            } catch (error) {
                log(`‚ùå Fallback mode test failed: ${error.message}`, 'error');
                updateStatus('Fallback mode test failed', 'error');
            }
        }
        
        async function testErrorHandling() {
            log('‚ö†Ô∏è Testing Error Handling...', 'info');
            updateStatus('Running error handling test...', 'warning');
            
            try {
                // Test navigation to non-existent page
                log('Testing navigation to non-existent page...');
                await navigateToPage('non-existent-page');
                
                // Test module error handling
                log('Testing module error handling...');
                if (window.RencanaStrategisModuleEnhanced) {
                    // Temporarily break the module
                    const originalLoad = window.RencanaStrategisModuleEnhanced.load;
                    window.RencanaStrategisModuleEnhanced.load = function() {
                        throw new Error('Test error');
                    };
                    
                    try {
                        await navigateToPage('rencana-strategis');
                    } catch (e) {
                        log(`‚úÖ Error properly caught: ${e.message}`, 'success');
                    }
                    
                    // Restore original function
                    window.RencanaStrategisModuleEnhanced.load = originalLoad;
                }
                
                updateStatus('Error handling test completed', 'success');
                
            } catch (error) {
                log(`‚ùå Error handling test failed: ${error.message}`, 'error');
                updateStatus('Error handling test failed', 'error');
            }
        }
        
        async function runAllTests() {
            log('üöÄ Running All Tests...', 'info');
            updateStatus('Running comprehensive test suite...', 'warning');
            
            const tests = [
                testBasicNavigation,
                testEnhancedNavigation,
                testNavigationLoop,
                testModuleLoading,
                testFallbackMode,
                testErrorHandling
            ];
            
            for (const test of tests) {
                try {
                    await test();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                } catch (error) {
                    log(`Test failed: ${error.message}`, 'error');
                }
            }
            
            log('üéâ All tests completed!', 'success');
            updateStatus('All tests completed successfully', 'success');
        }
        
        function clearLogs() {
            document.getElementById('test-logs').innerHTML = 'Test logs cleared...\n';
            updateStatus('Ready to run tests', 'info');
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('üîß Test page initialized', 'success');
            updateStatus('Test environment ready', 'success');
        });
    </script>
</body>
</html>
