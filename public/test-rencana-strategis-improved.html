<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rencana Strategis - Improved Interface</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/rencana-strategis-improved.css">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-light">
    <div class="container-fluid">
        <!-- Header -->
        <div class="row">
            <div class="col-12">
                <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="#">
                            <i class="fas fa-chart-line me-2"></i>
                            Manajemen Risiko
                        </a>
                        <div class="navbar-nav ms-auto">
                            <span class="navbar-text text-white">
                                <i class="fas fa-user me-1"></i>
                                Test User
                            </span>
                        </div>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white border-0 pb-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="h4 mb-1 text-primary">
                                    <i class="fas fa-chess me-2"></i>
                                    Rencana Strategis
                                </h2>
                                <p class="text-muted mb-0">Kelola rencana strategis organisasi</p>
                            </div>
                            <div class="badge bg-primary fs-6">
                                <i class="fas fa-database me-1"></i>
                                <span id="data-count">0</span> Data
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Main Content Area -->
                        <div id="rencana-strategis" class="page-content active">
                            <div id="rencana-strategis-content">
                                <!-- Content will be rendered here by JavaScript -->
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-3 text-muted">Memuat data rencana strategis...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- API Service -->
    <script src="/js/services/apiService.js"></script>
    
    <!-- Mock API for Testing -->
    <script>
        // Mock API function for testing
        window.apiCall = async function(endpoint, options = {}) {
            console.log('üì° API Call:', endpoint, options);
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            if (endpoint.includes('/api/rencana-strategis')) {
                if (endpoint.includes('/generate/kode')) {
                    return { kode: `RS-2025-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}` };
                }
                
                // Return mock data
                return [
                    {
                        id: '1',
                        kode: 'RS-2025-001',
                        nama_rencana: 'Peningkatan Keselamatan Pasien',
                        deskripsi: 'Program komprehensif untuk meningkatkan keselamatan pasien melalui implementasi protokol keselamatan yang ketat dan pelatihan berkelanjutan untuk seluruh staf medis.',
                        periode_mulai: '2025-01-01',
                        periode_selesai: '2025-12-31',
                        target: 'Menurunkan insiden keselamatan pasien sebesar 50% dan meningkatkan kepuasan pasien hingga 95%',
                        indikator_kinerja: 'Jumlah insiden per 1000 pasien',
                        status: 'Aktif',
                        visi_misi: {
                            id: '1',
                            misi: 'Memberikan pelayanan kesehatan berkualitas tinggi'
                        },
                        sasaran_strategis: ['Implementasi protokol keselamatan', 'Pelatihan staf berkelanjutan'],
                        indikator_kinerja_utama: ['Tingkat insiden', 'Kepuasan pasien']
                    },
                    {
                        id: '2',
                        kode: 'RS-2025-002',
                        nama_rencana: 'Digitalisasi Sistem Informasi',
                        deskripsi: 'Transformasi digital menyeluruh untuk meningkatkan efisiensi operasional dan kualitas pelayanan melalui implementasi sistem informasi terintegrasi.',
                        periode_mulai: '2025-02-01',
                        periode_selesai: '2025-11-30',
                        target: 'Implementasi 100% sistem digital dan peningkatan efisiensi operasional sebesar 40%',
                        indikator_kinerja: 'Persentase proses yang terdigitalisasi',
                        status: 'Draft',
                        visi_misi: {
                            id: '1',
                            misi: 'Memanfaatkan teknologi untuk pelayanan optimal'
                        },
                        sasaran_strategis: ['Implementasi HIS', 'Pelatihan pengguna sistem'],
                        indikator_kinerja_utama: ['Tingkat adopsi sistem', 'Efisiensi proses']
                    },
                    {
                        id: '3',
                        kode: 'RS-2025-003',
                        nama_rencana: 'Pengembangan SDM Berkelanjutan',
                        deskripsi: 'Program pengembangan sumber daya manusia yang berkelanjutan untuk meningkatkan kompetensi dan profesionalisme seluruh karyawan.',
                        periode_mulai: '2025-01-15',
                        periode_selesai: '2025-12-15',
                        target: 'Meningkatkan kompetensi 100% karyawan dan sertifikasi profesional 80% staf medis',
                        indikator_kinerja: 'Jumlah pelatihan dan sertifikasi yang diselesaikan',
                        status: 'Selesai',
                        visi_misi: {
                            id: '2',
                            misi: 'Mengembangkan SDM yang kompeten dan profesional'
                        },
                        sasaran_strategis: ['Program pelatihan berkelanjutan', 'Sertifikasi profesional'],
                        indikator_kinerja_utama: ['Tingkat kompetensi', 'Jumlah sertifikasi']
                    },
                    {
                        id: '4',
                        kode: 'RS-2025-004',
                        nama_rencana: 'Ekspansi Layanan Unggulan',
                        deskripsi: 'Pengembangan dan ekspansi layanan unggulan rumah sakit untuk meningkatkan daya saing dan memberikan pelayanan spesialistik terbaik.',
                        periode_mulai: '2025-03-01',
                        periode_selesai: '2025-10-31',
                        target: 'Membuka 3 layanan unggulan baru dan meningkatkan utilisasi layanan sebesar 60%',
                        indikator_kinerja: 'Jumlah layanan baru dan tingkat utilisasi',
                        status: 'Aktif',
                        visi_misi: {
                            id: '2',
                            misi: 'Menyediakan layanan kesehatan spesialistik terdepan'
                        },
                        sasaran_strategis: ['Pengembangan layanan baru', 'Peningkatan kualitas layanan'],
                        indikator_kinerja_utama: ['Jumlah layanan', 'Tingkat utilisasi']
                    },
                    {
                        id: '5',
                        kode: 'RS-2025-005',
                        nama_rencana: 'Optimalisasi Manajemen Keuangan',
                        deskripsi: 'Program optimalisasi manajemen keuangan untuk meningkatkan efisiensi biaya operasional dan sustainability finansial rumah sakit.',
                        periode_mulai: '2025-01-01',
                        periode_selesai: '2025-12-31',
                        target: 'Mengurangi biaya operasional 15% dan meningkatkan revenue 25%',
                        indikator_kinerja: 'Rasio efisiensi biaya dan pertumbuhan revenue',
                        status: 'Draft',
                        visi_misi: {
                            id: '3',
                            misi: 'Mengelola keuangan secara efisien dan berkelanjutan'
                        },
                        sasaran_strategis: ['Efisiensi biaya operasional', 'Diversifikasi sumber pendapatan'],
                        indikator_kinerja_utama: ['Cost efficiency ratio', 'Revenue growth']
                    },
                    {
                        id: '6',
                        kode: 'RS-2025-006',
                        nama_rencana: 'Peningkatan Infrastruktur Medis',
                        deskripsi: 'Modernisasi dan peningkatan infrastruktur medis untuk mendukung pelayanan kesehatan yang optimal dan sesuai standar internasional.',
                        periode_mulai: '2025-04-01',
                        periode_selesai: '2025-12-31',
                        target: 'Modernisasi 100% peralatan medis kritis dan renovasi 80% fasilitas',
                        indikator_kinerja: 'Persentase peralatan dan fasilitas yang dimodernisasi',
                        status: 'Aktif',
                        visi_misi: {
                            id: '3',
                            misi: 'Menyediakan infrastruktur medis berstandar internasional'
                        },
                        sasaran_strategis: ['Modernisasi peralatan medis', 'Renovasi fasilitas'],
                        indikator_kinerja_utama: ['Tingkat modernisasi', 'Kualitas fasilitas']
                    }
                ];
            }
            
            if (endpoint.includes('/api/visi-misi')) {
                return [
                    {
                        id: '1',
                        visi: 'Menjadi rumah sakit terdepan dalam pelayanan kesehatan berkualitas',
                        misi: 'Memberikan pelayanan kesehatan berkualitas tinggi\nMemanfaatkan teknologi untuk pelayanan optimal\nMengembangkan SDM yang kompeten dan profesional',
                        tahun: 2025
                    },
                    {
                        id: '2',
                        visi: 'Rumah sakit pilihan utama masyarakat',
                        misi: 'Menyediakan layanan kesehatan spesialistik terdepan\nMengelola keuangan secara efisien dan berkelanjutan\nMenyediakan infrastruktur medis berstandar internasional',
                        tahun: 2025
                    }
                ];
            }
            
            // Default response
            return { success: true, message: 'Operation completed successfully' };
        };

        // Mock auth ready function
        window.waitForAuthReady = async () => true;
    </script>

    <!-- Load the Improved Rencana Strategis module -->
    <script src="/js/rencana-strategis-improved.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Initializing Improved Rencana Strategis Test Page...');
            
            try {
                // Wait a moment for everything to be ready
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Load the improved module
                await loadRencanaStrategisImproved();
                
                // Update data count
                const updateDataCount = () => {
                    const dataCount = window.RencanaStrategisImproved?.state?.data?.length || 0;
                    const countElement = document.getElementById('data-count');
                    if (countElement) {
                        countElement.textContent = dataCount;
                    }
                };
                
                // Update count initially and periodically
                updateDataCount();
                setInterval(updateDataCount, 2000);
                
                console.log('‚úÖ Improved Rencana Strategis Test Page initialized successfully');
            } catch (error) {
                console.error('‚ùå Error initializing test page:', error);
            }
        });
    </script>
</body>
</html>