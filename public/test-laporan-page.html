<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Halaman Laporan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/laporan.css">
    <style>
        body { background: #f5f6fa; padding: 20px; }
        .test-header { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; padding: 2rem; border-radius: 16px; margin-bottom: 2rem; }
        .test-status { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .test-status.success { background: #d4edda; color: #155724; }
        .test-status.error { background: #f8d7da; color: #721c24; }
        .test-status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="test-header">
            <h1><i class="fas fa-file-alt mr-2"></i> Test Halaman Laporan</h1>
            <p class="mb-0">Verifikasi tampilan dan fungsi halaman /laporan</p>
        </div>

        <div id="test-results"></div>

        <!-- Laporan Content Container -->
        <div id="laporan" class="page-content" style="display: block;">
            <div class="page-header mb-4">
                <h1 class="page-title"><i class="fas fa-file-pdf mr-2"></i> Laporan</h1>
                <p class="page-subtitle text-muted">Laporan Manajemen Risiko</p>
            </div>
            <div id="laporan-content"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mock API -->
    <script>
        // Mock API call function
        window.apiCall = async function(endpoint) {
            console.log('API Call:', endpoint);
            
            // Mock data
            if (endpoint.includes('rencana-strategis')) {
                return [
                    { id: '1', nama_rencana: 'Rencana Strategis 2024-2028' },
                    { id: '2', nama_rencana: 'Rencana Strategis 2023-2027' }
                ];
            }
            if (endpoint.includes('work-units')) {
                return [
                    { id: '1', name: 'Direktur' },
                    { id: '2', name: 'Bagian Keuangan' },
                    { id: '3', name: 'Bagian SDM' }
                ];
            }
            return [];
        };

        // Mock auth token
        window.getAuthToken = async function() {
            return 'mock-token-12345';
        };

        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-status ${type}`;
            div.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'} mr-2"></i>${message}`;
            resultsDiv.appendChild(div);
        }

        async function runTests() {
            addTestResult('Memulai test halaman Laporan...', 'info');

            // Test 1: Check if LaporanModule exists
            if (typeof LaporanModule !== 'undefined') {
                addTestResult('✓ LaporanModule tersedia', 'success');
            } else {
                addTestResult('✗ LaporanModule tidak ditemukan', 'error');
                return;
            }

            // Test 2: Check if laporan-content exists
            const content = document.getElementById('laporan-content');
            if (content) {
                addTestResult('✓ Element laporan-content ditemukan', 'success');
            } else {
                addTestResult('✗ Element laporan-content tidak ditemukan', 'error');
                return;
            }

            // Test 3: Load module
            try {
                await LaporanModule.load();
                addTestResult('✓ LaporanModule.load() berhasil', 'success');
            } catch (e) {
                addTestResult(`✗ Error loading module: ${e.message}`, 'error');
                return;
            }

            // Test 4: Check if content rendered
            setTimeout(() => {
                const cards = document.querySelectorAll('.report-card, [style*="report-card"]');
                const reportCards = document.querySelectorAll('#laporan-content .card');
                
                if (reportCards.length > 0 || cards.length > 0) {
                    addTestResult(`✓ Konten berhasil dirender (${reportCards.length || cards.length} card ditemukan)`, 'success');
                } else {
                    addTestResult('⚠ Konten mungkin tidak dirender dengan benar', 'error');
                }

                // Test 5: Check filter section
                const filterRencana = document.getElementById('filter-laporan-rencana');
                const filterUnit = document.getElementById('filter-laporan-unit');
                
                if (filterRencana && filterUnit) {
                    addTestResult('✓ Filter dropdown tersedia', 'success');
                } else {
                    addTestResult('⚠ Filter dropdown tidak ditemukan', 'error');
                }

                // Test 6: Check buttons
                const excelButtons = document.querySelectorAll('button[onclick*="downloadExcel"]');
                const pdfButtons = document.querySelectorAll('button[onclick*="downloadPDF"]');
                const previewButtons = document.querySelectorAll('button[onclick*="showPreview"]');
                
                addTestResult(`✓ Tombol Excel: ${excelButtons.length}, PDF: ${pdfButtons.length}, Preview: ${previewButtons.length}`, 'success');

                addTestResult('Test selesai!', 'info');
            }, 1000);
        }
    </script>
    
    <script src="/js/laporan.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
