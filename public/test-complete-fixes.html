<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Fixes Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #1e7e34;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .iframe-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ Complete Fixes Test</h1>
            <p>Testing semua perbaikan: Risk Register, Laporan, dan Responsive Design</p>
        </div>

        <!-- Test 1: Risk Register API -->
        <div class="test-section">
            <h2>ğŸ“Š Test 1: Risk Register API</h2>
            <p>Testing endpoint API dan struktur data</p>
            <button class="btn" onclick="testRiskRegisterAPI()">Test API</button>
            <div id="api-result"></div>
        </div>

        <!-- Test 2: Risk Register Frontend -->
        <div class="test-section">
            <h2>ğŸ¨ Test 2: Risk Register Frontend</h2>
            <p>Testing tampilan tabel dengan kolom lengkap dan responsive</p>
            <button class="btn" onclick="testRiskRegisterFrontend()">Test Frontend</button>
            <div id="frontend-result"></div>
            <div id="risk-register-table"></div>
        </div>

        <!-- Test 3: Laporan Module -->
        <div class="test-section">
            <h2>ğŸ“‹ Test 3: Laporan Module</h2>
            <p>Testing halaman laporan dan tombol View</p>
            <button class="btn" onclick="testLaporanModule()">Test Laporan</button>
            <div id="laporan-result"></div>
            <div id="laporan-content"></div>
        </div>

        <!-- Test 4: Responsive Design -->
        <div class="test-section">
            <h2>ğŸ“± Test 4: Responsive Design</h2>
            <p>Testing responsive table dan overflow handling</p>
            <button class="btn" onclick="testResponsiveDesign()">Test Responsive</button>
            <div id="responsive-result"></div>
        </div>

        <!-- Test 5: Integration Test -->
        <div class="test-section">
            <h2>ğŸ”— Test 5: Integration Test</h2>
            <p>Testing integrasi lengkap aplikasi</p>
            <button class="btn btn-success" onclick="openMainApp()">Open Main App</button>
            <div id="integration-result"></div>
        </div>
    </div>

    <script src="/js/config.js"></script>
    <script src="/js/services/apiService.js"></script>
    <script src="/js/risk-register.js"></script>
    <script src="/js/laporan.js"></script>
    <script>
        // Test 1: Risk Register API
        async function testRiskRegisterAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<div class="info">Testing Risk Register API...</div>';
            
            try {
                const response = await fetch('/api/reports/risk-register-debug');
                const data = await response.json();
                
                if (response.ok && data.fullData) {
                    const stats = {
                        total: data.fullData.length,
                        withInherent: data.fullData.filter(d => d.risk_inherent_analysis?.length > 0).length,
                        withResidual: data.fullData.filter(d => d.risk_residual_analysis?.length > 0).length,
                        withTreatments: data.fullData.filter(d => d.risk_treatments?.length > 0).length,
                        withAppetite: data.fullData.filter(d => d.risk_appetite?.length > 0).length
                    };
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            âœ… API Test Passed!<br>
                            ğŸ“Š Total Records: ${stats.total}<br>
                            ğŸ“ˆ With Inherent: ${stats.withInherent}/${stats.total}<br>
                            ğŸ“‰ With Residual: ${stats.withResidual}/${stats.total}<br>
                            ğŸ›¡ï¸ With Treatments: ${stats.withTreatments}/${stats.total}<br>
                            ğŸ¯ With Appetite: ${stats.withAppetite}/${stats.total}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ API Test Failed: ${JSON.stringify(data)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ API Test Error: ${error.message}</div>`;
            }
        }

        // Test 2: Risk Register Frontend
        async function testRiskRegisterFrontend() {
            const resultDiv = document.getElementById('frontend-result');
            const tableDiv = document.getElementById('risk-register-table');
            
            resultDiv.innerHTML = '<div class="info">Testing Risk Register Frontend...</div>';
            
            try {
                const response = await fetch('/api/reports/risk-register-debug');
                const data = await response.json();
                
                if (response.ok && data.fullData) {
                    // Test the display function
                    displayRiskRegister(data.fullData);
                    
                    // Check if table was created
                    const table = tableDiv.querySelector('table');
                    const rows = tableDiv.querySelectorAll('tbody tr');
                    
                    if (table && rows.length > 0) {
                        resultDiv.innerHTML = `
                            <div class="success">
                                âœ… Frontend Test Passed!<br>
                                ğŸ“Š Table Created: Yes<br>
                                ğŸ“‹ Rows Generated: ${rows.length}<br>
                                ğŸ“± Responsive Wrapper: ${tableDiv.querySelector('.table-responsive') ? 'Yes' : 'No'}<br>
                                ğŸ¨ Styling Applied: ${tableDiv.querySelector('.badge') ? 'Yes' : 'No'}
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = '<div class="error">âŒ Frontend Test Failed: Table not created</div>';
                    }
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ Frontend Test Failed: No data</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ Frontend Test Error: ${error.message}</div>`;
            }
        }

        // Test 3: Laporan Module
        async function testLaporanModule() {
            const resultDiv = document.getElementById('laporan-result');
            const contentDiv = document.getElementById('laporan-content');
            
            resultDiv.innerHTML = '<div class="info">Testing Laporan Module...</div>';
            
            try {
                if (typeof window.laporanModule !== 'undefined') {
                    // Test module loading
                    await window.laporanModule.load();
                    
                    // Check if content was rendered
                    const cards = contentDiv.querySelectorAll('[onclick*="showPreview"]');
                    const filters = contentDiv.querySelectorAll('select, input[type="date"]');
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            âœ… Laporan Module Test Passed!<br>
                            ğŸ“‹ Module Loaded: Yes<br>
                            ğŸ´ Report Cards: ${cards.length}<br>
                            ğŸ” Filter Elements: ${filters.length}<br>
                            ğŸ‘ï¸ View Buttons: ${cards.length}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ Laporan Module not found</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ Laporan Test Error: ${error.message}</div>`;
            }
        }

        // Test 4: Responsive Design
        function testResponsiveDesign() {
            const resultDiv = document.getElementById('responsive-result');
            
            // Check CSS classes and responsive elements
            const responsiveElements = document.querySelectorAll('.table-responsive');
            const badges = document.querySelectorAll('.badge');
            const textAlignments = document.querySelectorAll('.text-center, .text-right');
            
            // Check if CSS is loaded
            const computedStyle = window.getComputedStyle(document.body);
            const hasCustomCSS = computedStyle.fontFamily.includes('Segoe UI');
            
            resultDiv.innerHTML = `
                <div class="success">
                    âœ… Responsive Design Test Results:<br>
                    ğŸ“± Responsive Wrappers: ${responsiveElements.length}<br>
                    ğŸ·ï¸ Badge Elements: ${badges.length}<br>
                    ğŸ“ Text Alignments: ${textAlignments.length}<br>
                    ğŸ¨ Custom CSS Loaded: ${hasCustomCSS ? 'Yes' : 'No'}<br>
                    ğŸ“ Viewport Meta: ${document.querySelector('meta[name="viewport"]') ? 'Yes' : 'No'}
                </div>
            `;
        }

        // Test 5: Integration Test
        function openMainApp() {
            const resultDiv = document.getElementById('integration-result');
            
            resultDiv.innerHTML = `
                <div class="info">
                    ğŸ”— Opening main application...<br>
                    <a href="/" target="_blank" class="btn">Open in New Tab</a>
                </div>
                <div class="iframe-container">
                    <iframe src="/" title="Main Application"></iframe>
                </div>
            `;
        }

        // Auto-run basic tests on page load
        window.addEventListener('load', function() {
            console.log('Complete Fixes Test Page loaded');
            
            // Auto-run API test
            setTimeout(() => {
                testRiskRegisterAPI();
            }, 1000);
        });
    </script>
</body>
</html>