<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Table Default Override</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .table-container {
            overflow-x: auto;
        }
        
        .badge {
            font-size: 0.75em;
        }
        
        .badge-success {
            background-color: #28a745;
        }
        
        .badge-warning {
            background-color: #ffc107;
            color: #212529;
        }
        
        .badge-secondary {
            background-color: #6c757d;
        }
        
        .action-group .btn {
            margin-left: 0.25rem;
        }
        
        .empty-state {
            padding: 3rem 1rem;
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .table-dark {
            background-color: #343a40;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.075);
        }
        
        .debug-panel {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.375rem;
        }
        
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="debug-panel">
            <h5>üß™ Table Default Override Test</h5>
            <div id="debug-info">
                <p><strong>Status:</strong> <span id="status">Initializing...</span></p>
                <p><strong>Current View:</strong> <span id="current-view">-</span></p>
                <p><strong>Table Section:</strong> <span id="table-status">-</span></p>
                <p><strong>Selection Section:</strong> <span id="selection-status">-</span></p>
                <p><strong>Override Active:</strong> <span id="override-status">-</span></p>
            </div>
        </div>
        
        <div id="rencana-strategis" class="page-content active">
            <div class="page-header">
                <h1 class="page-title"><i class="page-title-icon fas fa-chart-line"></i> Rencana Strategis</h1>
                <p class="page-subtitle">Perencanaan Strategis Organisasi</p>
            </div>
            <div id="rencana-strategis-content">
                <!-- Content will be rendered here -->
            </div>
        </div>
    </div>

    <script>
        // Mock API dengan data yang lebih lengkap
        window.apiCall = async (endpoint, options = {}) => {
            console.log('üì° API Call:', endpoint, options);
            
            if (endpoint.includes('/api/rencana-strategis')) {
                if (endpoint.includes('/generate/kode')) {
                    return { kode: `RS-2025-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}` };
                }
                
                // Return mock data
                return [
                    {
                        id: '1',
                        kode: 'RS-2025-001',
                        nama_rencana: 'Peningkatan Kualitas Pelayanan Kesehatan',
                        deskripsi: 'Rencana strategis untuk meningkatkan kualitas pelayanan kesehatan di rumah sakit',
                        periode_mulai: '2025-01-01',
                        periode_selesai: '2025-12-31',
                        target: 'Meningkatkan kepuasan pasien hingga 90%',
                        indikator_kinerja: 'Indeks Kepuasan Pasien',
                        status: 'Aktif'
                    },
                    {
                        id: '2',
                        kode: 'RS-2025-002',
                        nama_rencana: 'Digitalisasi Sistem Informasi',
                        deskripsi: 'Implementasi sistem informasi terintegrasi untuk efisiensi operasional',
                        periode_mulai: '2025-02-01',
                        periode_selesai: '2025-11-30',
                        target: 'Implementasi SIMRS 100%',
                        indikator_kinerja: 'Persentase Modul Terimplementasi',
                        status: 'Draft'
                    },
                    {
                        id: '3',
                        kode: 'RS-2025-003',
                        nama_rencana: 'Pengembangan SDM Medis',
                        deskripsi: 'Program pelatihan dan pengembangan kompetensi tenaga medis',
                        periode_mulai: '2025-03-01',
                        periode_selesai: '2025-12-31',
                        target: 'Pelatihan 100% tenaga medis',
                        indikator_kinerja: 'Persentase Tenaga Medis Terlatih',
                        status: 'Aktif'
                    }
                ];
            }
            
            if (endpoint.includes('/api/visi-misi')) {
                return [
                    {
                        id: '1',
                        visi: 'Menjadi rumah sakit terdepan dalam pelayanan kesehatan',
                        misi: '1. Memberikan pelayanan kesehatan berkualitas\n2. Mengembangkan teknologi medis terkini\n3. Meningkatkan kompetensi SDM'
                    }
                ];
            }
            
            return [];
        };

        window.app = { apiCall: window.apiCall };
        window.waitForAuthReady = async () => {
            console.log('‚úÖ Auth ready');
            return true;
        };

        // Global functions for onclick handlers
        window.viewDetail = (id) => {
            console.log('View detail:', id);
            alert('View detail untuk ID: ' + id);
        };

        window.startEdit = (id) => {
            console.log('Start edit:', id);
            alert('Edit untuk ID: ' + id);
        };

        window.deleteRencana = (id) => {
            console.log('Delete rencana:', id);
            if (confirm('Hapus rencana strategis ini?')) {
                alert('Rencana dengan ID ' + id + ' akan dihapus');
            }
        };

        // Debug functions
        function updateDebugInfo() {
            const tableSection = document.getElementById('table-section');
            const selectionSection = document.getElementById('selection-section');
            const formSection = document.getElementById('form-section');
            
            // Update status
            document.getElementById('table-status').textContent = tableSection ? 
                (tableSection.style.display === 'none' ? 'Hidden' : 'Visible') : 'Not Found';
            
            document.getElementById('selection-status').textContent = selectionSection ? 
                (selectionSection.style.display === 'none' ? 'Hidden' : 'Visible') : 'Not Found';
            
            document.getElementById('override-status').textContent = 
                window.RencanaStrategisModule && window.RencanaStrategisModule.forceTableView ? 'Active' : 'Inactive';
            
            // Determine current view
            let currentView = 'None';
            if (tableSection && tableSection.style.display !== 'none') {
                currentView = 'Table View';
            } else if (selectionSection && selectionSection.style.display !== 'none') {
                currentView = 'Selection View';
            } else if (formSection && formSection.style.display !== 'none') {
                currentView = 'Form View';
            }
            
            document.getElementById('current-view').textContent = currentView;
            
            return currentView;
        }
    </script>

    <!-- Load original module first -->
    <script src="/js/rencana-strategis.js"></script>
    
    <!-- Load override module -->
    <script src="/js/rencana-strategis-table-default.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Starting Table Default Override Test...');
            
            document.getElementById('status').textContent = 'Loading override...';
            
            try {
                // Wait for modules to be available
                let attempts = 0;
                while (!window.RencanaStrategisModule && attempts < 20) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.RencanaStrategisModule) {
                    throw new Error('RencanaStrategisModule not found after 20 attempts');
                }
                
                document.getElementById('status').textContent = 'Module found, loading...';
                
                // Load the enhanced module
                if (window.loadRencanaStrategis) {
                    await window.loadRencanaStrategis();
                } else {
                    await window.RencanaStrategisModule.load();
                }
                
                document.getElementById('status').innerHTML = '<span class="success">‚úÖ Module loaded successfully</span>';
                
                // Check view immediately
                setTimeout(() => {
                    const currentView = updateDebugInfo();
                    
                    if (currentView === 'Table View') {
                        document.getElementById('status').innerHTML = '<span class="success">‚úÖ SUCCESS: Table view is displayed as default!</span>';
                    } else {
                        document.getElementById('status').innerHTML = '<span class="error">‚ùå ISSUE: ' + currentView + ' is displayed instead of Table View</span>';
                    }
                }, 1000);
                
                // Set up periodic updates
                setInterval(updateDebugInfo, 3000);
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('status').innerHTML = '<span class="error">‚ùå ERROR: ' + error.message + '</span>';
            }
        });
    </script>
</body>
</html>